# 利用T1影像優化PDFF肝臟血管分析專案

[![Status](https://img.shields.io/badge/Status-In--Progress-orange)](https://shields.io/)

這是一個醫療影像處理專案，旨在解決 PDFF 序列中肝臟血管對比度不足的問題，以提升後續肝臟分割與脂肪定量分析的準確度。

本專案的核心策略是利用同一次掃描中，對比度更清晰的 T1 加權對比增強影像，透過先進的影像對位技術，將其血管資訊對應到 PDFF 影像空間，為後續分析提供更豐富的解剖結構細節。

## 核心處理流程

本專案的自動化處理管線包含以下四個關鍵步驟：

1.  **資料載入**：自動讀取指定病人的 T1 Contrast-Enhanced 和 PDFF 兩種 DICOM 影像序列。
2.  **兩階段影像對位**：採用「由粗到精」的策略，先進行快速的**仿射(Affine)對位**校正整體位置，再進行精細的**非剛性B-Spline對位**來擬合局部形變。
3.  **血管結構偵測**：在對位完成的 T1 影像上，使用 **Frangi 濾波器** 來增強並提取血管結構。
4.  **影像疊加與儲存**：將提取出的血管遮罩(Vessel Mask)疊加到原始的 PDFF 影像上，並將結果儲存為一個新的 DICOM 序列，以便後續分析與檢視。

## 主要技術棧

* **影像處理**: `SimpleITK`, `scikit-image`, `OpenCV`
* **數據處理**: `NumPy`, `pydicom`
* **視覺化與互動**: `matplotlib`, `ipywidgets`

## 專案元件說明

```text
MRI_Analysis_Project/
├── data/                    # 存放原始 DICOM 病人資料
├── output/                  # 存放處理完成後輸出的疊加影像
├── utils/                   # 核心演算法模組
│   ├── data_loader.py       # 專責載入 DICOM 影像序列
│   └── image_processing.py  # 包含影像對位、血管偵測等核心函式
├── main.py                  # 專案主程式：用於全自動批次處理所有病人
├── interactive_debugger.ipynb # Jupyter Notebook：互動式開發與除錯環境
├── requirements.txt         # Python 環境依賴列表，用於快速部署
└── README.md                # 專案說明文件 (本檔案)
```

## 當前進度與成果

* **[已完成]** 成功建立一套從資料載入到結果儲存的**全自動化處理管線** (`main.py`)。
* **[已完成]** 實現了穩健的**兩階段影像對位演算法**。在成功案例中，量化指標 `NDV` (非微分同胚體積) 為 **0%**，證明了形變的物理真實性與平滑度。
* **[已完成]** 開發了一套**互動式視覺化除錯工具** (`interactive_debugger.ipynb`)，能快速進行參數調校與結果驗證。

#### 成果預覽

*（建議您在這裡放一張效果最好的病人，對位前後的棋盤格對比圖，以及最終的血管疊加圖）*

![最終血管疊加成果](/Users/yuheng/Desktop/MRI_Analysis_Project/assets/好血管.jpg)
> 圖：成功案例的最終血管疊加成果，可見血管結構已精準疊加至 PDFF 影像上。

## 當前挑戰與下一步規劃

* **當前挑戰：演算法泛化性**
    * **現象**：目前的對位演算法採用固定參數，在部分初始位置差異過大或解剖結構特殊的病人案例上，對位效果不佳。

* **下一步規劃**
    2.  **優化血管偵測**：在目前的 Frangi 濾波後，加入**形態學後處理**步驟（如移除微小雜訊），提升最終血管遮罩的乾淨度與一致性。
    3.  **建立失敗案例分析流程**：利用互動式工具，針對目前效果不佳的案例進行參數與演算法的迭代優化。
